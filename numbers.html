<!doctype html>
<html>
  <head>
    <title>Kanerva's SDM Test</title>

    <style type="text/css">
      canvas {
        width: 880px;
        height: 176px;
        border: 1px solid #eee;
      }
    </style>
  </head>

  <body>
    <canvas id="canvas" width="55" height="11">
    </canvas>

    <script type="text/javascript" src="js/alea.js"></script>
    <script type="text/javascript" src="js/numbers.js"></script>
    <script type="text/javascript" src="js/sdm.js"></script>

    <script type="text/javascript">
      "use strict"

      function draw (id, bits) {
        var data = id.data,
            i = data.length,
            j = i * 0.25,
            k = j - 1

        while (j--) {
          data[--i] = bit (bits, j) * 255
          i -= 3
        }
      }

      function noisy (bits, n) {
        var arr = new Array (n),
            i = n,
            j

        while (i--)
          arr[i] = bit (bits, i)

        i = Math.floor (n * 0.2)
        while (i--) {
          j = Math.floor (Math.random () * n)
          arr[j] = 1 - arr[j]
        }

        return pack (arr)
      }

      var canvas = document.getElementById ("canvas"),
          ctx = canvas.getContext ("2d"),
          id = ctx.getImageData (0, 0, 5, 9),
          sdm = new Array (11 * 45 * 256),
          one = 0xe21084210c4,
          two = 0x19b844c8462e,
          three = 0xe8c60c4423f,
          four = 0x847d2910884,
          five = 0xe8c6107863f,
          six = 0xe8c63170888,
          seven = 0x4210888423f,
          eight = 0xe8c6317462e,
          nine = 0x2221d18c62e,
          a = 14,
          c, i

      sdmReset (sdm)
      sdmPut (sdm,     0,     0, 45, a)
      sdmPut (sdm,   one,   two, 45, a)
      sdmPut (sdm,   two, three, 45, a)
      sdmPut (sdm, three,  four, 45, a)
      sdmPut (sdm,  four,  five, 45, a)
      sdmPut (sdm,  five,   six, 45, a)
      sdmPut (sdm,   six, seven, 45, a)
      sdmPut (sdm, seven, eight, 45, a)
      sdmPut (sdm, eight,  nine, 45, a)
      sdmPut (sdm,  nine,     0, 45, a)

      setInterval (function () {
        c = noisy (one, 45)
        draw (id, c)
        ctx.putImageData (id, 1, 1)

        for (i = 1; i !== 9; ++i) {
          c = sdmGet (sdm, c, 45, a)
          draw (id, c)
          ctx.putImageData (id, i * 6 + 1, 1)
        }
      }, 0)
    </script>
  </body>
</html>
